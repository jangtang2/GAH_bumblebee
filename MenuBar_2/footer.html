<!-- 상단 메뉴 배경 색상 변경 스크립트(PC) - 개선 버전 -->
<script>
  (function () {
    if (window.innerWidth < 992) return;

    let initialized = false;

    function initMenu() {
      if (initialized) {
        return true;
      }

      const navElement = document.querySelector('#s2025070198187fb0bd6e3');
      const menu = document.querySelectorAll('.menuToggle.customMenu');

      if (!navElement || menu.length === 0) {
        return false;
      }

      // 각 섹션별 배경색 명시적 지정
      const sectionColors = {
        's202507012c13dbe9bfd3d': 'white',
        's202507015b37210bd8139': 'white',
        's202507012de9911fded25': 'white',
        's20250826cb316a1ecba50': 'white',
        's202507018d8322a2fd389': 'black',
        's2025070113fe458cba567': 'black',
        's20250701cfd3071397a2a': 'white',
        's202507015a429359b165a': 'black',
        's20250701dbcd534faee2c': 'black',
        's202507012170110d7c57d': 'black',
        's20250701f457bab25e7df': 'white',
        's20250701e11089f3b7131': 'white',
        's20250701850c08f917f9f': 'white'
      };

      const sections = document.querySelectorAll('.section_wrap.pc_section');
      const textSpans = navElement.querySelectorAll('.custom-flow-container .custom-flow-text span');
      const menuDivs = navElement.querySelectorAll('.menuToggle.customMenu p');

      const navStyles = {
        opaque: {
          backgroundColor: 'rgba(0, 0, 0, 0.25)',
          color: '#fff',
          borderColor: 'rgba(255, 255, 255, 0.2)',
        },
        white: {
          backgroundColor: 'rgb(255, 255, 255)',
          color: '#000',
          borderColor: 'rgba(0, 0, 0, 0.2)',
        },
        black: {
          backgroundColor: 'rgb(0, 0, 0)',
          color: '#fff',
          borderColor: 'rgba(255, 255, 255, 0.2)',
        },
      };

      function updateStyles(currentStyle) {
        Object.assign(navElement.style, {
          backgroundColor: currentStyle.backgroundColor,
          color: currentStyle.color,
          borderColor: currentStyle.borderColor,
        });

        textSpans.forEach((span) => {
          span.style.color = currentStyle.color;
        });

        menuDivs.forEach((p) => {
          p.style.backgroundColor = currentStyle.color;
        });

        menu.forEach((div) => {
          div.style.borderColor = currentStyle.borderColor;
        });

        const whiteLogo = navElement.querySelectorAll('.flow-logo-white');
        const blackLogo = navElement.querySelectorAll('.flow-logo-black');
        
        if (currentStyle.color === '#fff') {
          whiteLogo.forEach(logo => logo.style.display = 'block');
          blackLogo.forEach(logo => logo.style.display = 'none');
        } else {
          whiteLogo.forEach(logo => logo.style.display = 'none');
          blackLogo.forEach(logo => logo.style.display = 'block');
        }
      }

      menu.forEach(function (menuBtn) {
        menuBtn.addEventListener('click', function () {
          let expanded = this.getAttribute('aria-expanded') === 'true';

          if (!expanded) {
            document.body.classList.add('no-scroll');
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.height = '100%';
            
            this.setAttribute('aria-expanded', 'true');
            updateStyles(navStyles.black);
          } else {
            setTimeout(() => {
              document.body.classList.remove('no-scroll');
              document.body.style.overflow = '';
              document.body.style.position = '';
              document.body.style.width = '';
              document.body.style.height = '';
              
              this.setAttribute('aria-expanded', 'false');
            }, 1000);
            setTimeout(() => {
              updateStyles(navStyles.opaque);
            }, 1600);
          }
        });
      });

      sections.forEach((section, index) => {
        // 섹션별 배경색 지정 (명시적으로 정의된 것만)
        if (sectionColors[section.id]) {
          section.dataset.background = sectionColors[section.id];
          console.log(`Section ${index} (${section.id}): ${sectionColors[section.id]}`);
        } else {
          // 정의되지 않은 섹션은 기본값 white
          section.dataset.background = 'white';
          console.log(`Section ${index} (${section.id}): white (default)`);
        }
      });

      function updateNavBackground() {
        // 스크롤이 최좌측이면 white 적용
        if (window.pageXOffset === 0 && window.pageYOffset === 0) {
          updateStyles(navStyles.white);
          return;
        }

        let currentStyle = null;
        let targetSection = null;
        let minDistance = Infinity;

        console.log('=== Scroll Detection ===');
        sections.forEach((section) => {
          const rect = section.getBoundingClientRect();
          const zIndex = window.getComputedStyle(section).zIndex;
          console.log(`${section.id}: left=${rect.left.toFixed(1)}, right=${rect.right.toFixed(1)}, width=${rect.width.toFixed(1)}, z-index=${zIndex}, bg=${section.dataset.background}`);

          // 화면 왼쪽 경계 근처에 있는 섹션 찾기
          // left가 0에 가까우면서, right가 화면 내에 있는 섹션만 선택
          if (rect.left <= 50 && rect.left > -rect.width && rect.right > 100 && rect.width > 0) {
            const distance = Math.abs(rect.left);
            // 같은 거리면 나중에 나온 섹션(DOM 순서상 위에 있을 가능성 높음)을 선택
            if (distance <= minDistance) {
              minDistance = distance;
              targetSection = section;
            }
          }
        });

        // 가장 가까운 섹션의 배경 스타일 적용
        if (targetSection && targetSection.dataset.background) {
          console.log(`>>> Selected: ${targetSection.id}, bg=${targetSection.dataset.background}, left=${targetSection.getBoundingClientRect().left.toFixed(1)}`);
          currentStyle = navStyles[targetSection.dataset.background];
        }

        // currentStyle이 없으면 기본값 white 적용
        if (!currentStyle) {
          currentStyle = navStyles.white;
        }

        if (currentStyle && navElement.style.backgroundColor !== currentStyle.backgroundColor) {
          console.log(`Updating nav to: ${targetSection?.dataset.background}`);
          updateStyles(currentStyle);
        }
      }

      window.addEventListener('scroll', updateNavBackground);
      Object.assign(navElement.style, navStyles.white);
      updateNavBackground();

      initialized = true;
      return true;
    }

    let attemptCount = 0;
    const maxAttempts = 30;

    function tryInitialize() {
      if (initialized) return;
      
      attemptCount++;
      
      if (initMenu()) {
        return;
      }
      
      if (attemptCount < maxAttempts) {
        setTimeout(tryInitialize, 200);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', tryInitialize);
    } else {
      tryInitialize();
    }

    window.addEventListener('load', function() {
      setTimeout(tryInitialize, 100);
      setTimeout(tryInitialize, 500);
      setTimeout(tryInitialize, 1000);
    });

  })();
</script>

<!-- 상단 메뉴 배경 색상 변경 스크립트(Mobile) - 개선 버전 -->
<script>
  (function () {
    if (window.innerWidth > 991) return;

    // CSS 강제 적용 + loading-txt 차단
    const style = document.createElement('style');
    style.textContent = `
      .menuToggle.customMenu.mo * {
        pointer-events: none !important;
      }
      .menuToggle.customMenu.mo {
        pointer-events: auto !important;
        z-index: 10000 !important;
      }
      p.loading-txt {
        pointer-events: none !important;
        z-index: -1 !important;
      }
    `;
    document.head.appendChild(style);
    
    // loading-txt 요소 직접 숨기기
    setTimeout(function() {
      const loadingElements = document.querySelectorAll('p.loading-txt');
      loadingElements.forEach((el) => {
        el.style.setProperty('pointer-events', 'none', 'important');
        el.style.setProperty('z-index', '-1', 'important');
        el.style.setProperty('display', 'none', 'important');
      });
    }, 100);

    let initialized = false;

    function initMenu() {
      if (initialized) {
        return true;
      }

      const navElement = document.querySelector('#s202507018bdbf5f2ae522');
      const slidingElement = document.getElementById('s20250701850c08f917f9f');
      const slidingContent = document.querySelector('.custom-menu-container');
      const menu = document.querySelectorAll('.menuToggle.customMenu.mo');

      if (!navElement || !slidingElement || !slidingContent || menu.length === 0) {
        return false;
      }

      const blackSections = [''];
      const excludedSections = [''];
      const sections = document.querySelectorAll('.section_wrap.mobile_section');
      const textSpans = navElement.querySelectorAll('.custom-flow-container.mo .custom-flow-text span');
      const menuDivs = navElement.querySelectorAll('.menuToggle.customMenu.mo p');

      const navStyles = {
        opaque: {
          backgroundColor: 'rgba(0, 0, 0, 0.25)',
          color: '#c49a6c',
          borderColor: 'rgba(187, 149, 111, 0.5)',
        },
        white: {
          backgroundColor: 'rgb(255, 255, 255)',
          color: '#c49a6c',
          borderColor: 'rgba(187, 149, 111, 0.5)',
        },
        black: {
          backgroundColor: '#162249',
          color: '#c49a6c',
          borderColor: 'rgba(187, 149, 111, 0.5)',
        },
      };

      function updateStyles(currentStyle) {
        Object.assign(navElement.style, {
          backgroundColor: currentStyle.backgroundColor,
          color: currentStyle.color,
          borderColor: currentStyle.borderColor,
        });

        textSpans.forEach((span) => {
          span.style.color = currentStyle.color;
        });

        menuDivs.forEach((p) => {
          p.style.backgroundColor = currentStyle.color;
        });

        menu.forEach((div) => {
          div.style.borderColor = currentStyle.borderColor;
        });
      }

      menu.forEach(function (menuBtn) {
        // 자식 요소들의 pointer-events 비활성화
        const children = menuBtn.querySelectorAll('*');
        children.forEach((child) => {
          child.style.setProperty('pointer-events', 'none', 'important');
        });
        
        menuBtn.style.setProperty('pointer-events', 'auto', 'important');
        menuBtn.style.setProperty('z-index', '10000', 'important');
        
        const handleMenuClick = function (e) {
          e.preventDefault();
          e.stopPropagation();
          
          let expanded = menuBtn.getAttribute('aria-expanded') === 'true';

          if (!expanded) {
            document.body.classList.add('no-scroll');
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.height = '100%';
            
            menuBtn.setAttribute('aria-expanded', 'true');
            slidingElement.classList.add('active');
            slidingContent.classList.add('active');
            updateStyles(navStyles.black);
          } else {
            slidingContent.classList.remove('active');
            setTimeout(() => {
              document.body.classList.remove('no-scroll');
              document.body.style.overflow = '';
              document.body.style.position = '';
              document.body.style.width = '';
              document.body.style.height = '';
              
              menuBtn.setAttribute('aria-expanded', 'false');
              slidingElement.classList.remove('active');
            }, 1000);
            setTimeout(() => {
              updateStyles(navStyles.opaque);
            }, 1600);
          }
        };

        menuBtn.addEventListener('touchstart', handleMenuClick, { passive: false });
        menuBtn.addEventListener('click', handleMenuClick);
      });

      sections.forEach((section, index) => {
        if (excludedSections.includes(section.id)) {
          return;
        }
        if (blackSections.includes(section.id)) {
          section.dataset.background = 'black';
        } else if (index <= 3) {
          section.dataset.background = 'opaque';
        } else {
          section.dataset.background = 'white';
        }
      });

      function updateNavBackground() {
        let currentStyle = navStyles['opaque'];

        sections.forEach((section) => {
          const rect = section.getBoundingClientRect();

          if (excludedSections.includes(section.id)) {
            return;
          }

          if (rect.top <= 30 && window.pageYOffset !== 0) {
            currentStyle = navStyles[section.dataset.background];
          }
        });

        if (currentStyle && navElement.style.backgroundColor !== currentStyle.backgroundColor) {
          updateStyles(currentStyle);
        }
      }

      window.addEventListener('scroll', updateNavBackground, { passive: true });
      updateNavBackground();

      initialized = true;
      return true;
    }

    let attemptCount = 0;
    const maxAttempts = 30;

    function tryInitialize() {
      if (initialized) return;
      
      attemptCount++;
      
      if (initMenu()) {
        return;
      }
      
      if (attemptCount < maxAttempts) {
        setTimeout(tryInitialize, 200);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', tryInitialize);
    } else {
      tryInitialize();
    }

    window.addEventListener('load', function() {
      setTimeout(tryInitialize, 100);
      setTimeout(tryInitialize, 500);
      setTimeout(tryInitialize, 1000);
    });

  })();
</script>